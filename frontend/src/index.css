@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

@layer components {
  .close-icon {
    @apply w-3 h-3 stroke-2;
    /* Ensure the icon uses theme foreground with a fallback */
    color: var(--foreground, #ffffff);
    stroke: currentColor;
    fill: none;
    display: block;
    stroke-linecap: square;
    stroke-linejoin: miter;
  }

  .settings-icon {
    @apply h-6 w-6 stroke-2;
  }

  .loader-icon {
    @apply h-8 w-8 text-white animate-spin stroke-3;
  }

  .titlebar {
    @apply fixed top-0 left-0 w-full h-10 flex items-center justify-between z-50 bg-background;
    -webkit-app-region: drag;
  }

  .titlebar-button {
    @apply inline-flex items-center justify-center w-7 h-7 rounded-full text-foreground transition-colors duration-200 hover:bg-white/20;
    -webkit-app-region: no-drag;
  }

  /* Close button variant (icon-only): borderless, red hover */
  .btn-close {
    @apply inline-flex items-center justify-center w-7 h-7 rounded-full;
    /* Use theme foreground with a safe fallback to ensure visibility */
    color: var(--foreground, #ffffff);
    /* Prevent Electron titlebar drag region from capturing clicks */
    -webkit-app-region: no-drag;
    background: transparent;
  }
  .btn-close:hover {
    background: color-mix(in srgb, var(--button-destructive) 80%, transparent);
  }
  .btn-close:active {
    background: color-mix(in srgb, var(--button-destructive) 65%, transparent);
  }

  /* Utility to prevent Electron titlebar drag from capturing events */
  .no-drag {
    -webkit-app-region: no-drag;
  }

  .app-container {
    @apply h-screen flex flex-col pt-10 bg-background text-foreground;
  }

  .content-container {
    @apply flex-1 overflow-auto;
  }

  // Background success animation for ProgressBar.
  @keyframes shine {
    to {
      background-position: 200% center;
    }
  }

  .complete-progress {
    background: linear-gradient(
      90deg,
      #ffd700,
      #ffc000,
      #ffa500,
      #ffc000,
      #ffd700
    );
    background-size: 200% auto;
    animation: shine 2s linear infinite;
  }

  /* Strong golden glow utility for completed bars */
  .gold-glow {
    box-shadow:
      0 0 0 2px color-mix(in srgb, #ffd700 35%, transparent) inset,
      0 0 18px 4px color-mix(in srgb, #ffd700 55%, transparent),
      0 0 45px 12px color-mix(in srgb, #ffc000 35%, transparent);
    transition: box-shadow 150ms linear;
  }

  .confetti-overlay {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 45;
  }

  .overlay-dim {
    @apply fixed inset-0 flex items-center justify-center p-4;
    background: color-mix(in srgb, var(--background) 55%, black);
  }

  .panel-base {
    @apply bg-background rounded-lg border border-neutral;
  }

  .icon-success {
    color: #22c55e;
  } /* green-500 */
  .icon-error {
    color: #ef4444;
  } /* red-500 */

  ::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  ::-webkit-scrollbar-track {
    background: transparent;
  }

  ::-webkit-scrollbar-thumb {
    background: var(--neutral);
    border-radius: 3px;
    border: 1px solid var(--background);
  }

  ::-webkit-scrollbar-thumb:hover {
    background: color-mix(in srgb, var(--neutral) 80%, white);
  }

  /* Button: unified primary with hover scale */
  .btn {
    @apply inline-flex items-center justify-center px-4 py-2 rounded-md disabled:opacity-50 disabled:pointer-events-none origin-center transition-colors;
    /* Base background is supplied by variants via --btn-bg */
    background: var(--btn-bg);
    transition-duration: 75ms;
    transition-timing-function: ease-out;
  }

  /* Background-only hover/active without affecting text color */
  .btn:hover {
    background: color-mix(in srgb, var(--btn-bg) 85%, transparent);
  }
  .btn:active {
    background: color-mix(in srgb, var(--btn-bg) 65%, transparent);
  }

  .btn-primary {
    --btn-bg: var(--button-primary);
    color: var(--foreground);
  }
  .btn-secondary {
    --btn-bg: var(--button-secondary);
    color: var(--foreground);
  }
  .btn-destructive {
    --btn-bg: var(--button-destructive);
    color: var(--foreground);
  }

  /* Per-bar hover glow helpers; colors supplied via CSS variables on the element */
  .bar-hover-right {
    /* Fixed opacity ~60% via color-mix; default lime-500 if var not set */
    box-shadow: 0 0 20px 5px
      color-mix(in srgb, var(--bar-increment-hover, #84cc16) 60%, transparent) !important;
    transition: box-shadow 100ms linear;
  }
  .bar-hover-left {
    /* Fixed opacity ~60% via color-mix; default orange-600 if var not set */
    box-shadow: 0 0 20px 5px
      color-mix(in srgb, var(--bar-decrement-hover, #ea580c) 60%, transparent) !important;
    transition: box-shadow 100ms linear;
  }

  /* Modal content with sticky footer */
  .modal-content {
    @apply overflow-y-auto pr-1 -mr-1;
    max-height: calc(80vh - 140px);
  }
  .modal-footer {
    @apply sticky bottom-0 bg-background border-t border-neutral p-4 mt-4 -mx-6 px-6 -mb-6;
  }

  /* Themed gray/neutral text utilities derived from theme vars */
  .text-muted {
    color: color-mix(in srgb, var(--foreground) 60%, var(--background));
  }
  .text-subtle {
    color: color-mix(in srgb, var(--foreground) 75%, var(--background));
  }

  /* Input surface using theme background, slightly lifted for contrast */
  .input-surface {
    background: color-mix(in srgb, var(--background) 85%, white);
    color: var(--foreground);
  }

  /* Gray background utilities */
  .bg-input {
    background-color: var(--neutral);
  }
  .border-input {
    border-color: var(--neutral);
  }
  .border-neutral {
    border-color: var(--neutral);
  }
  .bg-neutral {
    background-color: var(--neutral);
  }

  /* Red color utilities */
  .text-error {
    @apply text-red-500;
  }
  .border-error {
    @apply border-red-500;
  }
  .bg-error {
    @apply bg-red-500/20;
  }

  /* Blue color utilities */
  .border-focus {
    @apply border-blue-400;
  }
}

@theme inline {
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-primary: var(--button-primary);
  --color-muted: var(--muted);
  --color-border: var(--neutral);
  --color-ring: var(--ring);
  --color-neutral: var(--neutral);
}

:root {
  --radius: 0.625rem;
  --background: #0f172a; /* slate-900 */
  --foreground: #ffffff;
  --button-primary: #84cc16; /* lime-500 */
  --button-secondary: #4b5563; /* gray-600 */
  --button-destructive: #dc2626; /* red-600 */
  --muted: #f1f5f9; /* slate-100 */
  --border: #334155; /* slate-700 - DEPRECATED, use neutral instead */
  --ring: #60a5fa; /* blue-400 */
  --neutral: #6b7280; /* gray-500 */
}

@layer base {
  * {
    @apply border-neutral outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}
